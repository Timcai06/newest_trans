# UI组件化开发规范表

## 一、核心原则

### 1.1 不影响现有功能
- **功能一致性**：新组件必须保持与现有功能完全一致
- **API兼容性**：组件API设计需考虑现有代码的使用习惯
- **向后兼容**：确保旧代码在迁移过程中仍能正常工作
- **无破坏性变更**：不修改现有功能的核心逻辑

### 1.2 不影响现有UI设计
- **样式一致性**：组件样式必须与现有设计完全一致
- **主题适配**：支持现有的浅色/深色主题切换
- **动画效果**：保持与现有动画效果一致
- **视觉层次**：遵循现有设计的视觉层次结构

### 1.3 分小步骤执行
- **最小化改动**：每个步骤只做一件事情，确保可控制
- **逐步迁移**：现有代码迁移要逐步进行，避免一次性改动过大
- **充分测试**：每个步骤完成后都要进行测试
- **迭代开发**：采用迭代方式开发组件，逐步完善

## 二、组件设计规范

### 2.1 组件命名规范
- **组件类名**：使用PascalCase，如`Button`、`WordCard`、`StatsCard`、`CircleProgress`
- **组件文件名**：使用kebab-case，如`button.js`、`word-card.js`、`stats-card.js`、`circle-progress.js`
- **CSS类名**：使用BEM命名规范，如`.btn--primary`、`word-card__content`、`stats-card__header`
- **CSS变量名**：使用kebab-case，前缀`--component-name-`，如`--button-primary-color`、`--stats-card-background`

### 2.1.1 学习概览组件命名规范
- **统计卡片类名**：`StatsCard`
- **环形进度图类名**：`CircleProgress`
- **连续学习日历类名**：`StreakCalendar`
- **单词学习趋势图类名**：`WordTrendChart`
- **CSS类名前缀**：`.stats-card-`、`.circle-progress-`、`.streak-calendar-`、`.word-trend-`

### 2.2 组件结构规范
```javascript
/**
 * 组件描述
 * @class ComponentName
 * @extends BaseComponent
 */
class ComponentName extends BaseComponent {
  /**
   * 构造函数
   * @param {Object} props - 组件属性
   */
  constructor(props) {
    super(props);
    // 初始化props和state
  }
  
  /**
   * 注册组件样式
   */
  registerStyle() {
    // 注册组件CSS样式
  }
  
  /**
   * 渲染组件
   * @returns {HTMLElement} - 渲染后的DOM元素
   */
  render() {
    // 创建和配置DOM元素
    return element;
  }
  
  /**
   * 更新组件
   * @param {Object} newProps - 新的组件属性
   */
  update(newProps) {
    // 更新组件状态和DOM
  }
  
  /**
   * 销毁组件
   */
  destroy() {
    // 清理事件监听和DOM元素
  }
}

export { ComponentName };
```

### 2.3 组件Props规范
- **必填项**：明确标识必填props
- **默认值**：为可选props提供合理默认值
- **类型检查**：对props进行类型检查
- **简洁性**：props数量不宜过多（建议不超过10个）

### 2.4 组件事件规范
- **事件命名**：使用on前缀，如`onClick`、`onClose`
- **事件参数**：提供清晰的事件参数
- **事件触发**：在适当的时机触发事件
- **事件清理**：组件销毁时清理事件监听

## 三、样式开发规范

### 3.1 主题适配规范
- **CSS变量**：使用CSS变量定义所有主题相关样式
- **主题切换**：支持通过CSS变量自动切换主题
- **兼容性**：确保CSS变量与现有样式兼容
- **一致性**：主题颜色、圆角、阴影等与现有设计一致

### 3.2 样式隔离规范
- **BEM命名**：使用BEM命名规范，避免样式冲突
- **组件前缀**：为每个组件的CSS类名添加组件前缀
- **样式注入**：通过style-manager.js动态注入样式
- **避免全局样式**：不修改全局样式，只修改组件自身样式

### 3.3 样式性能规范
- **GPU加速**：使用transform和opacity实现动画，触发GPU加速
- **避免重绘回流**：减少DOM操作，避免触发布局重排
- **样式简洁**：避免复杂的CSS选择器
- **按需加载**：组件样式按需加载，不影响页面加载速度

## 四、组件开发流程规范

### 4.1 需求分析规范
- **功能分析**：明确组件的功能需求
- **样式分析**：分析现有样式，确保组件样式一致
- **API设计**：设计简洁易用的组件API
- **使用场景**：考虑组件的各种使用场景

### 4.2 组件实现规范
- **基础组件优先**：先开发基础组件，再开发复合组件
- **继承基类**：所有组件必须继承自BaseComponent
- **注册样式**：组件必须通过style-manager.js注册样式
- **注册组件**：组件必须通过component-registry.js注册

### 4.3 组件测试规范
- **单元测试**：为每个组件编写单元测试
- **功能测试**：测试组件的各种功能
- **样式测试**：测试组件在不同主题下的样式
- **性能测试**：测试组件的渲染和更新性能

### 4.4 组件文档规范
- **组件描述**：详细描述组件的功能和用途
- **Props说明**：列出所有props，包括类型、默认值、说明
- **事件说明**：列出所有事件，包括参数、说明
- **使用示例**：提供完整的组件使用示例

### 4.5 依赖管理规范
- **依赖关系检查**：每一次小更新后，都必须检查文件之间的路径依赖关系
- **依赖图更新**：及时更新项目根目录下的`DEPENDENCY-GRAPH.md`文件，清晰记录文件间的依赖关系
- **依赖关系可视化**：使用清晰的图表或列表形式展示依赖关系
- **依赖冲突处理**：确保组件之间的依赖关系清晰，避免循环依赖
- **依赖版本管理**：如果引入外部依赖，必须明确指定版本号

## 五、现有代码迁移规范

### 5.1 迁移准备规范
- **代码分析**：分析现有代码结构和样式
- **依赖关系**：理清代码间的依赖关系
- **迁移计划**：制定详细的迁移计划
- **测试准备**：准备测试用例，确保迁移后功能正常

### 5.2 迁移实施规范
- **逐步迁移**：逐个文件、逐个功能进行迁移
- **保持功能一致**：迁移过程中确保功能不变
- **保持样式一致**：迁移过程中确保样式不变
- **测试验证**：每个迁移步骤完成后都要进行测试

### 5.3 迁移验收规范
- **功能验收**：验证迁移后的功能与原功能一致
- **样式验收**：验证迁移后的样式与原样式一致
- **性能验收**：验证迁移后的性能不低于原性能
- **代码验收**：验证迁移后的代码质量符合要求

## 六、组件工具规范

### 6.1 组件注册器规范
- **单例模式**：组件注册器使用单例模式
- **注册API**：提供简洁的组件注册API
- **创建API**：提供简洁的组件创建API
- **组件管理**：支持组件的注册、查询、创建

### 6.2 样式管理器规范
- **单例模式**：样式管理器使用单例模式
- **样式注入**：支持动态注入组件样式
- **样式隔离**：确保组件样式不影响其他组件
- **主题支持**：支持主题切换

### 6.3 事件总线规范
- **单例模式**：事件总线使用单例模式
- **事件订阅**：支持事件的订阅和发布
- **事件管理**：支持事件的取消订阅
- **性能优化**：避免事件总线成为性能瓶颈

## 七、质量保证规范

### 7.1 测试覆盖率规范
- **基础组件**：≥90%
- **复合组件**：≥80%
- **业务组件**：≥70%
- **关键功能**：100%

### 7.2 性能规范
- **渲染时间**：单个组件渲染时间≤50ms
- **更新时间**：单个组件更新时间≤30ms
- **内存占用**：组件内存占用≤1MB
- **事件处理**：事件处理时间≤10ms

### 7.3 可访问性规范
- **键盘导航**：支持键盘导航
- **ARIA属性**：提供适当的ARIA属性
- **文本对比度**：确保文本对比度符合WCAG标准
- **屏幕阅读器支持**：支持屏幕阅读器

### 7.4 代码质量规范
- **代码风格**：遵循项目现有的代码风格
- **注释规范**：添加必要的注释，包括组件描述、props说明、事件说明
- **代码简洁**：避免冗余代码，保持代码简洁
- **模块化**：组件逻辑模块化，便于维护

## 八、实施流程规范

### 8.1 阶段划分规范
- **准备阶段**：创建目录结构、开发基础工具、定义CSS变量
- **基础组件开发阶段**：开发按钮、卡片、输入框等基础组件
- **复合组件开发阶段**：开发翻译记录卡片、统计卡片等复合组件
- **业务组件开发阶段**：开发学习面板、搜索栏等业务组件
- **布局组件开发阶段**：开发头部、内容区域等布局组件
- **现有代码迁移阶段**：逐步迁移现有代码
- **测试和优化阶段**：进行单元测试、集成测试、视觉测试、性能测试
- **文档编写和验收阶段**：编写组件文档、使用指南，进行项目验收

### 8.2 步骤执行规范
- **最小化改动**：每个步骤只做一件事情，确保可控制
- **逐步执行**：按照计划逐步执行，避免跳跃式开发
- **充分测试**：每个步骤完成后都要进行测试
- **及时调整**：根据测试结果及时调整计划

### 8.3 沟通协作规范
- **定期汇报**：定期汇报项目进展
- **问题沟通**：及时沟通遇到的问题
- **知识共享**：分享组件开发经验和最佳实践
- **代码审查**：进行代码审查，确保代码质量

## 九、风险控制规范

### 9.1 风险识别规范
- **功能风险**：组件化可能影响现有功能
- **样式风险**：组件化可能影响现有UI设计
- **性能风险**：组件化可能导致性能问题
- **迁移风险**：现有代码迁移可能遇到困难

### 9.2 风险应对规范
- **充分测试**：每个步骤完成后都要进行测试
- **样式一致性**：组件样式与现有设计保持一致
- **性能优化**：优化组件性能，确保不影响页面加载速度
- **逐步迁移**：现有代码迁移要逐步进行，避免一次性改动过大
- **向后兼容**：确保新组件支持现有代码的使用方式

### 9.3 应急处理规范
- **回滚机制**：建立代码回滚机制，确保出现问题时能快速恢复
- **问题定位**：建立问题定位机制，快速定位和解决问题
- **应急预案**：制定应急预案，应对各种可能的风险
- **沟通机制**：建立快速沟通机制，及时处理问题

## 十、后续维护规范

### 10.1 组件更新规范
- **版本管理**：组件应包含版本信息，重大变更时更新版本
- **向后兼容**：确保组件更新后向后兼容
- **更新日志**：记录组件的所有变更
- **测试验证**：组件更新后进行充分测试
- **依赖检查**：更新组件后检查依赖关系，更新DEPENDENCY-GRAPH.md

### 10.2 组件维护规范
- **bug修复**：及时修复组件bug
- **性能优化**：定期优化组件性能
- **功能扩展**：根据需求扩展组件功能
- **文档更新**：及时更新组件文档
- **依赖更新**：定期检查组件依赖，确保依赖关系清晰

### 10.3 组件废弃规范
- **废弃通知**：提前通知组件废弃计划
- **过渡期**：提供足够的过渡期，让用户迁移到新组件
- **替代方案**：提供替代组件或解决方案
- **代码清理**：在适当的时候清理废弃组件代码
- **依赖更新**：清理废弃组件后更新依赖关系，更新DEPENDENCY-GRAPH.md

## 十一、规范遵守检查清单

### 11.1 组件设计检查
- [ ] 组件命名符合规范
- [ ] 组件结构符合规范
- [ ] 组件Props设计合理
- [ ] 组件事件设计合理

### 11.2 样式开发检查
- [ ] 使用CSS变量定义主题样式
- [ ] 支持浅色/深色主题切换
- [ ] 使用BEM命名规范
- [ ] 样式与现有设计一致

### 11.3 组件实现检查
- [ ] 组件继承自BaseComponent
- [ ] 组件注册了样式
- [ ] 组件注册到了组件注册器
- [ ] 组件实现了所有必要的方法

### 11.4 组件测试检查
- [ ] 编写了单元测试
- [ ] 测试了组件的各种功能
- [ ] 测试了组件在不同主题下的样式
- [ ] 测试了组件的性能

### 11.5 组件文档检查
- [ ] 提供了组件描述
- [ ] 提供了Props说明
- [ ] 提供了事件说明
- [ ] 提供了使用示例

### 11.6 现有代码迁移检查
- [ ] 保持了功能一致
- [ ] 保持了样式一致
- [ ] 进行了充分测试
- [ ] 代码质量符合要求

### 11.7 依赖管理检查
- [ ] 检查了文件之间的路径依赖关系
- [ ] 更新了DEPENDENCY-GRAPH.md文件
- [ ] 避免了循环依赖
- [ ] 明确指定了外部依赖版本

## 十二、违规处理规范

### 12.1 违规类型
- **轻微违规**：代码风格不符合规范，不影响功能和样式
- **中度违规**：组件API设计不合理，影响开发效率
- **严重违规**：影响现有功能或样式，导致bug
- **文档违规**：未及时更新依赖关系图或组件文档

### 12.2 违规处理
- **轻微违规**：提醒开发者修改，下次注意
- **中度违规**：要求开发者重构组件API
- **严重违规**：暂停开发，修复问题，重新测试
- **文档违规**：要求开发者补充完善文档，更新依赖关系图

### 12.3 预防措施
- **代码审查**：加强代码审查，及时发现问题
- **培训教育**：加强开发者培训，提高规范意识
- **工具支持**：使用工具自动检查代码规范
- **定期检查**：定期检查组件规范遵守情况，包括依赖关系图更新

---

# 规范执行跟踪表

| 规范类型 | 规范项 | 执行情况 | 检查人 | 检查日期 | 备注 |
|----------|--------|----------|--------|----------|------|
| 核心原则 | 不影响现有功能 | | | | |
| 核心原则 | 不影响现有UI设计 | | | | |
| 核心原则 | 分小步骤执行 | | | | |
| 组件设计 | 组件命名规范 | | | | |
| 组件设计 | 组件结构规范 | | | | |
| 组件设计 | 组件Props规范 | | | | |
| 组件设计 | 组件事件规范 | | | | |
| 样式开发 | 主题适配规范 | | | | |
| 样式开发 | 样式隔离规范 | | | | |
| 样式开发 | 样式性能规范 | | | | |
| 开发流程 | 需求分析规范 | | | | |
| 开发流程 | 组件实现规范 | | | | |
| 开发流程 | 组件测试规范 | | | | |
| 开发流程 | 组件文档规范 | | | | |
| 开发流程 | 依赖管理规范 | | | | |
| 代码迁移 | 迁移准备规范 | | | | |
| 代码迁移 | 迁移实施规范 | | | | |
| 代码迁移 | 迁移验收规范 | | | | |
| 质量保证 | 测试覆盖率规范 | | | | |
| 质量保证 | 性能规范 | | | | |
| 质量保证 | 可访问性规范 | | | | |
| 质量保证 | 代码质量规范 | | | | |
| 依赖管理 | 依赖关系检查 | | | | |
| 依赖管理 | 依赖图更新 | | | | |

---

**制定日期**：2026-01-08
**生效日期**：2026-01-09
**适用范围**：谷歌翻译插件UI组件化开发
**修订历史**：
- V1.0 (2026-01-08)：初始版本
- V1.1 (2026-01-08)：添加依赖管理规范，明确要求每一次小更新后检查文件路径依赖并更新DEPENDENCY-GRAPH.md

本规范旨在确保UI组件化开发过程中不影响现有功能和UI设计，分小步骤执行，提高代码复用性和可维护性。所有参与UI组件化开发的人员必须严格遵守本规范。